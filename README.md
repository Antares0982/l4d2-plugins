# l4d2-plugins

求生之路2插件，均为原创。

一开始只是想要一个友伤反伤插件。但是网上的几个反伤插件均有bug，例如快倒地时被反伤会达到65535血之类，还有就是不可以手动调整反伤倍率……综合以上原因就决定自己写插件。

国内没有比较好的求生之路插件教学，无奈只能东拼西凑，结果到处碰壁。最终找到了新版source pawn API的网页，最终完成了我的第一个插件。

后来又因为娱乐需求写了一个打队友回血插件……自此AI队友没法活着过安全门（

之后可能还会继续写插件吧，如果这个游戏还能一直玩下去的话。

### return_dmg.sp

这个插件作用是反伤，会适当增加游戏难度。

会生成一个cfg文件，在cfg文件里调整反伤的倍率，目录是`left4dead2/cfg/sourcemod/return_dmg.cfg`。

反伤的倍率也就是`1/l4d_damage_fflimit`。如果给队友造成了`l4d_damage_fflimit`点伤害，就会受到一点伤害。

如果需要反伤可以制服攻击者，将`l4d_damage_ffincapacitate`设为1，否则设为0.

如果要达到打队友太多自动踢出服务器的效果，只需要将`l4d_damage_ffkick`设为1即可。`l4d_damage_ffkicklimit`表示，如果总友伤达到这个数值，就会把攻击者踢出游戏。

喜欢对bot造成友伤？那就需要把`l4d_damage_returnbotdmg`设置为0.如果需要打bot也会被反伤，将这个参数设为1.

### ff_add_health.sp

这个插件是娱乐向。

打队友会吸收队友的生命值。生命值不会吸收到100以上。

如果你已经倒地过一次且没有使用急救包，那么吸收的生命值将会是虚血，无论队友倒地过几次。同样的，如果你没有倒地过，或者使用了急救包，吸收的生命值将是实血，无论队友生命值如何。

队友倒地也可以吸他的血。但是在队友倒地且血量低于200时，无法吸血。

如果你未倒地过（或使用了急救包）且同时有实血和虚血，打队友造成伤害超过（100-总血量），但不超过（100-实血）时，会回复对应伤害的实血，并将使得总血量多于100点的那部分虚血去除。

（打了这个插件的话，基本上bot没法活着进安全门）

### broadcast.sp

定时广播插件。用处可能并不是很大。可以在插件内设置广播时间。（之后会再设置一个cfg文件，用来读取广播文字和广播间隔）

### newplayerremind.sp

加入/退出游戏的提醒。





### 一些source pawn函数的用法

##### IsFakeClient(int client)

返回bool值。如果是电脑操纵的角色将返回true，玩家操纵的角色返回false。

##### GetClientTeam(int client)

返回一个小的整数，一般是1或者2.写在这的原因是，1或者2不固定代表哪个队伍，有可能是生还者也可能是特感。

##### OnClientDisconnect(int client)

会在用户断开连接时执行这个函数的内容。

##### CreateTimer(float interval, Timer func, any data, int flags)

返回一个Handle。第一个参数是定时时间。第二个参数是计时结束后执行的函数，它需要的参数会写在第三个参数的位置，如果不需要参数，用下划线`_`代替这个参数。第四个参数如果是`TIMER_REPEAT`则会在计时时间到之后再次执行。如果是`TIMER_FLAG_NO_MAPCHANGE`则不会在过关后重置timer。这些参数可以同时设置，用按位与/或即可。

